/*
 * luts.c
 *
 *  Created on: 6. jun. 2025
 *      Author: theis
 */


/*
 * luts.c
 *
 *  Created on: 8. jan. 2025
 *      Author: theis
 */

#include "luts.h"
#include <stdint.h>
#include <stdio.h>
#include <fixp.h>
#define LUTCOUNT 1024
#define SIN_FULL_CYCLE (4 * LUTCOUNT)    // 4096 samples from 0 to 2Ï€
#define PI16 205887
#define Q16_ONE     (1 << 16)

// constants
const uint16_t sin_lut[1024] = { 0, 50, 101, 151, 201, 251, 302, 352, 402, 452, 503, 553, 603, 653, 704, 754, 804, 854, 905, 955, 1005, 1055, 1106, 1156, 1206, 1256, 1307, 1357, 1407, 1457, 1507, 1558, 1608, 1658, 1708, 1758, 1809, 1859, 1909, 1959, 2009, 2060, 2110, 2160, 2210, 2260, 2310, 2360, 2411, 2461, 2511, 2561, 2611, 2661, 2711, 2761, 2811, 2861, 2912, 2962, 3012, 3062, 3112, 3162, 3212, 3262, 3312, 3362, 3412, 3462, 3512, 3562, 3612, 3662, 3712, 3762, 3812, 3861, 3911, 3961, 4011, 4061, 4111, 4161, 4211, 4260, 4310, 4360, 4410, 4460, 4510, 4559, 4609, 4659, 4709, 4758, 4808, 4858, 4907, 4957, 5007, 5057, 5106, 5156, 5205, 5255, 5305, 5354, 5404, 5453, 5503, 5553, 5602, 5652, 5701, 5751, 5800, 5850, 5899, 5948, 5998, 6047, 6097, 6146, 6195, 6245, 6294, 6343, 6393, 6442, 6491, 6541, 6590, 6639, 6688, 6737, 6787, 6836, 6885, 6934, 6983, 7032, 7081, 7130, 7180, 7229, 7278, 7327, 7376, 7425, 7473, 7522, 7571, 7620, 7669, 7718, 7767, 7816, 7864, 7913, 7962, 8011, 8059, 8108, 8157, 8206, 8254, 8303, 8351, 8400, 8449, 8497, 8546, 8594, 8643, 8691, 8740, 8788, 8836, 8885, 8933, 8982, 9030, 9078, 9127, 9175, 9223, 9271, 9319, 9368, 9416, 9464, 9512, 9560, 9608, 9656, 9704, 9752, 9800, 9848, 9896, 9944, 9992, 10040, 10088, 10135, 10183, 10231, 10279, 10326, 10374, 10422, 10469, 10517, 10565, 10612, 10660, 10707, 10755, 10802, 10850, 10897, 10945, 10992, 11039, 11087, 11134, 11181, 11228, 11276, 11323, 11370, 11417, 11464, 11511, 11558, 11605, 11652, 11699, 11746, 11793, 11840, 11887, 11934, 11980, 12027, 12074, 12121, 12167, 12214, 12261, 12307, 12354, 12400, 12447, 12493, 12540, 12586, 12633, 12679, 12725, 12772, 12818, 12864, 12910, 12957, 13003, 13049, 13095, 13141, 13187, 13233, 13279, 13325, 13371, 13417, 13463, 13508, 13554, 13600, 13646, 13691, 13737, 13783, 13828, 13874, 13919, 13965, 14010, 14056, 14101, 14146, 14192, 14237, 14282, 14327, 14373, 14418, 14463, 14508, 14553, 14598, 14643, 14688, 14733, 14778, 14823, 14867, 14912, 14957, 15002, 15046, 15091, 15136, 15180, 15225, 15269, 15314, 15358, 15402, 15447, 15491, 15535, 15580, 15624, 15668, 15712, 15756, 15800, 15844, 15888, 15932, 15976, 16020, 16064, 16108, 16151, 16195, 16239, 16282, 16326, 16369, 16413, 16456, 16500, 16543, 16587, 16630, 16673, 16717, 16760, 16803, 16846, 16889, 16932, 16975, 17018, 17061, 17104, 17147, 17190, 17233, 17275, 17318, 17361, 17403, 17446, 17488, 17531, 17573, 17616, 17658, 17700, 17743, 17785, 17827, 17869, 17911, 17953, 17995, 18037, 18079, 18121, 18163, 18205, 18247, 18288, 18330, 18372, 18413, 18455, 18496, 18538, 18579, 18621, 18662, 18703, 18745, 18786, 18827, 18868, 18909, 18950, 18991, 19032, 19073, 19114, 19155, 19195, 19236, 19277, 19317, 19358, 19399, 19439, 19479, 19520, 19560, 19601, 19641, 19681, 19721, 19761, 19801, 19841, 19881, 19921, 19961, 20001, 20041, 20081, 20120, 20160, 20200, 20239, 20279, 20318, 20357, 20397, 20436, 20475, 20515, 20554, 20593, 20632, 20671, 20710, 20749, 20788, 20827, 20865, 20904, 20943, 20981, 21020, 21059, 21097, 21136, 21174, 21212, 21251, 21289, 21327, 21365, 21403, 21441, 21479, 21517, 21555, 21593, 21631, 21668, 21706, 21744, 21781, 21819, 21856, 21894, 21931, 21968, 22006, 22043, 22080, 22117, 22154, 22191, 22228, 22265, 22302, 22339, 22375, 22412, 22449, 22485, 22522, 22558, 22595, 22631, 22668, 22704, 22740, 22776, 22812, 22848, 22884, 22920, 22956, 22992, 23028, 23064, 23099, 23135, 23170, 23206, 23241, 23277, 23312, 23348, 23383, 23418, 23453, 23488, 23523, 23558, 23593, 23628, 23663, 23697, 23732, 23767, 23801, 23836, 23870, 23905, 23939, 23973, 24008, 24042, 24076, 24110, 24144, 24178, 24212, 24246, 24279, 24313, 24347, 24380, 24414, 24448, 24481, 24514, 24548, 24581, 24614, 24647, 24680, 24713, 24746, 24779, 24812, 24845, 24878, 24910, 24943, 24976, 25008, 25041, 25073, 25105, 25138, 25170, 25202, 25234, 25266, 25298, 25330, 25362, 25394, 25425, 25457, 25489, 25520, 25552, 25583, 25615, 25646, 25677, 25708, 25739, 25771, 25802, 25833, 25863, 25894, 25925, 25956, 25986, 26017, 26048, 26078, 26108, 26139, 26169, 26199, 26229, 26259, 26290, 26320, 26349, 26379, 26409, 26439, 26468, 26498, 26528, 26557, 26586, 26616, 26645, 26674, 26704, 26733, 26762, 26791, 26820, 26848, 26877, 26906, 26935, 26963, 26992, 27020, 27049, 27077, 27105, 27133, 27162, 27190, 27218, 27246, 27273, 27301, 27329, 27357, 27384, 27412, 27440, 27467, 27494, 27522, 27549, 27576, 27603, 27630, 27657, 27684, 27711, 27738, 27765, 27791, 27818, 27844, 27871, 27897, 27924, 27950, 27976, 28002, 28028, 28054, 28080, 28106, 28132, 28158, 28183, 28209, 28234, 28260, 28285, 28311, 28336, 28361, 28386, 28411, 28436, 28461, 28486, 28511, 28536, 28560, 28585, 28610, 28634, 28658, 28683, 28707, 28731, 28755, 28779, 28803, 28827, 28851, 28875, 28899, 28922, 28946, 28970, 28993, 29016, 29040, 29063, 29086, 29109, 29132, 29155, 29178, 29201, 29224, 29247, 29269, 29292, 29314, 29337, 29359, 29381, 29404, 29426, 29448, 29470, 29492, 29514, 29535, 29557, 29579, 29600, 29622, 29643, 29665, 29686, 29707, 29729, 29750, 29771, 29792, 29813, 29833, 29854, 29875, 29895, 29916, 29936, 29957, 29977, 29997, 30018, 30038, 30058, 30078, 30098, 30118, 30137, 30157, 30177, 30196, 30216, 30235, 30254, 30274, 30293, 30312, 30331, 30350, 30369, 30388, 30407, 30425, 30444, 30462, 30481, 30499, 30518, 30536, 30554, 30572, 30590, 30608, 30626, 30644, 30662, 30680, 30697, 30715, 30732, 30750, 30767, 30784, 30801, 30819, 30836, 30853, 30869, 30886, 30903, 30920, 30936, 30953, 30969, 30986, 31002, 31018, 31034, 31050, 31067, 31082, 31098, 31114, 31130, 31146, 31161, 31177, 31192, 31207, 31223, 31238, 31253, 31268, 31283, 31298, 31313, 31328, 31342, 31357, 31372, 31386, 31400, 31415, 31429, 31443, 31457, 31471, 31485, 31499, 31513, 31527, 31540, 31554, 31568, 31581, 31594, 31608, 31621, 31634, 31647, 31660, 31673, 31686, 31699, 31711, 31724, 31737, 31749, 31761, 31774, 31786, 31798, 31810, 31822, 31834, 31846, 31858, 31870, 31881, 31893, 31904, 31916, 31927, 31938, 31950, 31961, 31972, 31983, 31994, 32005, 32015, 32026, 32037, 32047, 32058, 32068, 32078, 32088, 32099, 32109, 32119, 32129, 32138, 32148, 32158, 32167, 32177, 32186, 32196, 32205, 32214, 32224, 32233, 32242, 32251, 32259, 32268, 32277, 32286, 32294, 32303, 32311, 32319, 32328, 32336, 32344, 32352, 32360, 32368, 32376, 32383, 32391, 32398, 32406, 32413, 32421, 32428, 32435, 32442, 32449, 32456, 32463, 32470, 32477, 32483, 32490, 32496, 32503, 32509, 32515, 32522, 32528, 32534, 32540, 32546, 32551, 32557, 32563, 32568, 32574, 32579, 32585, 32590, 32595, 32600, 32605, 32610, 32615, 32620, 32625, 32629, 32634, 32638, 32643, 32647, 32651, 32656, 32660, 32664, 32668, 32672, 32675, 32679, 32683, 32686, 32690, 32693, 32697, 32700, 32703, 32706, 32709, 32712, 32715, 32718, 32721, 32723, 32726, 32729, 32731, 32733, 32736, 32738, 32740, 32742, 32744, 32746, 32748, 32749, 32751, 32753, 32754, 32756, 32757, 32758, 32759, 32760, 32761, 32762, 32763, 32764, 32765, 32766, 32766, 32767, 32767, 32767, 32768, 32768, 32768};
const int32_t atan_lut[1024] = { 0, 64, 128, 192, 256, 320, 384, 448, 512, 577, 641, 705, 769, 833, 897, 961, 1025, 1089, 1153, 1217, 1281, 1345, 1409, 1473, 1537, 1601, 1665, 1729, 1793, 1857, 1921, 1985, 2049, 2113, 2177, 2241, 2305, 2369, 2433, 2497, 2561, 2625, 2689, 2753, 2817, 2881, 2945, 3009, 3073, 3137, 3201, 3264, 3328, 3392, 3456, 3520, 3584, 3648, 3712, 3776, 3839, 3903, 3967, 4031, 4095, 4158, 4222, 4286, 4350, 4414, 4477, 4541, 4605, 4669, 4732, 4796, 4860, 4924, 4987, 5051, 5115, 5178, 5242, 5306, 5369, 5433, 5496, 5560, 5624, 5687, 5751, 5814, 5878, 5941, 6005, 6069, 6132, 6196, 6259, 6323, 6386, 6449, 6513, 6576, 6640, 6703, 6766, 6830, 6893, 6957, 7020, 7083, 7147, 7210, 7273, 7336, 7400, 7463, 7526, 7589, 7653, 7716, 7779, 7842, 7905, 7968, 8031, 8095, 8158, 8221, 8284, 8347, 8410, 8473, 8536, 8599, 8662, 8725, 8788, 8850, 8913, 8976, 9039, 9102, 9165, 9228, 9290, 9353, 9416, 9479, 9541, 9604, 9667, 9729, 9792, 9855, 9917, 9980, 10043, 10105, 10168, 10230, 10293, 10355, 10418, 10480, 10542, 10605, 10667, 10730, 10792, 10854, 10917, 10979, 11041, 11103, 11166, 11228, 11290, 11352, 11414, 11477, 11539, 11601, 11663, 11725, 11787, 11849, 11911, 11973, 12035, 12097, 12159, 12220, 12282, 12344, 12406, 12468, 12529, 12591, 12653, 12715, 12776, 12838, 12900, 12961, 13023, 13084, 13146, 13207, 13269, 13330, 13392, 13453, 13515, 13576, 13637, 13699, 13760, 13821, 13882, 13944, 14005, 14066, 14127, 14188, 14249, 14310, 14371, 14432, 14493, 14554, 14615, 14676, 14737, 14798, 14859, 14920, 14980, 15041, 15102, 15163, 15223, 15284, 15345, 15405, 15466, 15526, 15587, 15647, 15708, 15768, 15829, 15889, 15949, 16010, 16070, 16130, 16191, 16251, 16311, 16371, 16431, 16491, 16551, 16611, 16671, 16731, 16791, 16851, 16911, 16971, 17031, 17091, 17151, 17210, 17270, 17330, 17389, 17449, 17509, 17568, 17628, 17687, 17747, 17806, 17866, 17925, 17985, 18044, 18103, 18162, 18222, 18281, 18340, 18399, 18458, 18518, 18577, 18636, 18695, 18754, 18813, 18871, 18930, 18989, 19048, 19107, 19166, 19224, 19283, 19342, 19400, 19459, 19517, 19576, 19634, 19693, 19751, 19810, 19868, 19926, 19985, 20043, 20101, 20159, 20218, 20276, 20334, 20392, 20450, 20508, 20566, 20624, 20682, 20740, 20798, 20855, 20913, 20971, 21029, 21086, 21144, 21201, 21259, 21317, 21374, 21432, 21489, 21546, 21604, 21661, 21718, 21776, 21833, 21890, 21947, 22004, 22061, 22119, 22176, 22233, 22289, 22346, 22403, 22460, 22517, 22574, 22630, 22687, 22744, 22800, 22857, 22914, 22970, 23027, 23083, 23140, 23196, 23252, 23309, 23365, 23421, 23477, 23533, 23590, 23646, 23702, 23758, 23814, 23870, 23926, 23982, 24037, 24093, 24149, 24205, 24260, 24316, 24372, 24427, 24483, 24538, 24594, 24649, 24705, 24760, 24815, 24871, 24926, 24981, 25036, 25091, 25146, 25202, 25257, 25312, 25366, 25421, 25476, 25531, 25586, 25641, 25695, 25750, 25805, 25859, 25914, 25968, 26023, 26077, 26132, 26186, 26241, 26295, 26349, 26403, 26458, 26512, 26566, 26620, 26674, 26728, 26782, 26836, 26890, 26944, 26997, 27051, 27105, 27159, 27212, 27266, 27320, 27373, 27427, 27480, 27533, 27587, 27640, 27694, 27747, 27800, 27853, 27906, 27959, 28013, 28066, 28119, 28172, 28224, 28277, 28330, 28383, 28436, 28488, 28541, 28594, 28646, 28699, 28751, 28804, 28856, 28909, 28961, 29013, 29066, 29118, 29170, 29222, 29274, 29327, 29379, 29431, 29483, 29535, 29586, 29638, 29690, 29742, 29794, 29845, 29897, 29949, 30000, 30052, 30103, 30155, 30206, 30257, 30309, 30360, 30411, 30462, 30514, 30565, 30616, 30667, 30718, 30769, 30820, 30871, 30922, 30972, 31023, 31074, 31125, 31175, 31226, 31276, 31327, 31377, 31428, 31478, 31529, 31579, 31629, 31679, 31730, 31780, 31830, 31880, 31930, 31980, 32030, 32080, 32130, 32180, 32229, 32279, 32329, 32379, 32428, 32478, 32527, 32577, 32626, 32676, 32725, 32775, 32824, 32873, 32922, 32972, 33021, 33070, 33119, 33168, 33217, 33266, 33315, 33364, 33412, 33461, 33510, 33559, 33607, 33656, 33705, 33753, 33802, 33850, 33898, 33947, 33995, 34043, 34092, 34140, 34188, 34236, 34284, 34332, 34380, 34428, 34476, 34524, 34572, 34620, 34668, 34715, 34763, 34811, 34858, 34906, 34953, 35001, 35048, 35096, 35143, 35190, 35238, 35285, 35332, 35379, 35426, 35473, 35520, 35567, 35614, 35661, 35708, 35755, 35802, 35849, 35895, 35942, 35989, 36035, 36082, 36128, 36175, 36221, 36268, 36314, 36360, 36406, 36453, 36499, 36545, 36591, 36637, 36683, 36729, 36775, 36821, 36867, 36913, 36958, 37004, 37050, 37096, 37141, 37187, 37232, 37278, 37323, 37369, 37414, 37459, 37505, 37550, 37595, 37640, 37685, 37731, 37776, 37821, 37866, 37910, 37955, 38000, 38045, 38090, 38135, 38179, 38224, 38269, 38313, 38358, 38402, 38447, 38491, 38535, 38580, 38624, 38668, 38712, 38757, 38801, 38845, 38889, 38933, 38977, 39021, 39065, 39109, 39152, 39196, 39240, 39284, 39327, 39371, 39414, 39458, 39501, 39545, 39588, 39632, 39675, 39718, 39762, 39805, 39848, 39891, 39934, 39977, 40020, 40063, 40106, 40149, 40192, 40235, 40278, 40320, 40363, 40406, 40448, 40491, 40533, 40576, 40618, 40661, 40703, 40746, 40788, 40830, 40872, 40915, 40957, 40999, 41041, 41083, 41125, 41167, 41209, 41251, 41293, 41334, 41376, 41418, 41459, 41501, 41543, 41584, 41626, 41667, 41709, 41750, 41792, 41833, 41874, 41915, 41957, 41998, 42039, 42080, 42121, 42162, 42203, 42244, 42285, 42326, 42367, 42408, 42448, 42489, 42530, 42570, 42611, 42652, 42692, 42733, 42773, 42813, 42854, 42894, 42935, 42975, 43015, 43055, 43095, 43135, 43176, 43216, 43256, 43296, 43335, 43375, 43415, 43455, 43495, 43534, 43574, 43614, 43653, 43693, 43733, 43772, 43812, 43851, 43890, 43930, 43969, 44008, 44048, 44087, 44126, 44165, 44204, 44243, 44282, 44321, 44360, 44399, 44438, 44477, 44516, 44554, 44593, 44632, 44670, 44709, 44748, 44786, 44825, 44863, 44902, 44940, 44978, 45017, 45055, 45093, 45131, 45170, 45208, 45246, 45284, 45322, 45360, 45398, 45436, 45474, 45511, 45549, 45587, 45625, 45662, 45700, 45738, 45775, 45813, 45850, 45888, 45925, 45963, 46000, 46037, 46075, 46112, 46149, 46186, 46224, 46261, 46298, 46335, 46372, 46409, 46446, 46483, 46520, 46556, 46593, 46630, 46667, 46703, 46740, 46777, 46813, 46850, 46886, 46923, 46959, 46996, 47032, 47068, 47105, 47141, 47177, 47213, 47250, 47286, 47322, 47358, 47394, 47430, 47466, 47502, 47538, 47573, 47609, 47645, 47681, 47717, 47752, 47788, 47823, 47859, 47895, 47930, 47966, 48001, 48036, 48072, 48107, 48142, 48178, 48213, 48248, 48283, 48318, 48353, 48389, 48424, 48459, 48493, 48528, 48563, 48598, 48633, 48668, 48702, 48737, 48772, 48807, 48841, 48876, 48910, 48945, 48979, 49014, 49048, 49083, 49117, 49151, 49185, 49220, 49254, 49288, 49322, 49356, 49390, 49425, 49459, 49493, 49526, 49560, 49594, 49628, 49662, 49696, 49729, 49763, 49797, 49831, 49864, 49898, 49931, 49965, 49998, 50032, 50065, 50099, 50132, 50165, 50199, 50232, 50265, 50298, 50331, 50364, 50398, 50431, 50464, 50497, 50530, 50563, 50595, 50628, 50661, 50694, 50727, 50760, 50792, 50825, 50858, 50890, 50923, 50955, 50988, 51020, 51053, 51085, 51118, 51150, 51182, 51215, 51247, 51279, 51311, 51343, 51376, 51408, 51440, 51472};
const int32_t asin_lut[1024] = { 0, 64, 128, 192, 256, 320, 384, 448, 513, 577, 641, 705, 769, 833, 897, 961, 1025, 1089, 1153, 1217, 1281, 1345, 1409, 1474, 1538, 1602, 1666, 1730, 1794, 1858, 1922, 1986, 2050, 2114, 2179, 2243, 2307, 2371, 2435, 2499, 2563, 2627, 2691, 2756, 2820, 2884, 2948, 3012, 3076, 3140, 3204, 3269, 3333, 3397, 3461, 3525, 3589, 3653, 3718, 3782, 3846, 3910, 3974, 4038, 4103, 4167, 4231, 4295, 4359, 4424, 4488, 4552, 4616, 4681, 4745, 4809, 4873, 4937, 5002, 5066, 5130, 5195, 5259, 5323, 5387, 5452, 5516, 5580, 5644, 5709, 5773, 5837, 5902, 5966, 6030, 6095, 6159, 6223, 6288, 6352, 6417, 6481, 6545, 6610, 6674, 6738, 6803, 6867, 6932, 6996, 7061, 7125, 7189, 7254, 7318, 7383, 7447, 7512, 7576, 7641, 7705, 7770, 7834, 7899, 7963, 8028, 8092, 8157, 8222, 8286, 8351, 8415, 8480, 8545, 8609, 8674, 8738, 8803, 8868, 8932, 8997, 9062, 9126, 9191, 9256, 9320, 9385, 9450, 9515, 9579, 9644, 9709, 9774, 9838, 9903, 9968, 10033, 10098, 10163, 10227, 10292, 10357, 10422, 10487, 10552, 10617, 10682, 10747, 10811, 10876, 10941, 11006, 11071, 11136, 11201, 11266, 11331, 11396, 11461, 11527, 11592, 11657, 11722, 11787, 11852, 11917, 11982, 12047, 12113, 12178, 12243, 12308, 12373, 12439, 12504, 12569, 12634, 12700, 12765, 12830, 12896, 12961, 13026, 13092, 13157, 13222, 13288, 13353, 13419, 13484, 13549, 13615, 13680, 13746, 13811, 13877, 13942, 14008, 14074, 14139, 14205, 14270, 14336, 14402, 14467, 14533, 14599, 14664, 14730, 14796, 14861, 14927, 14993, 15059, 15125, 15190, 15256, 15322, 15388, 15454, 15520, 15586, 15652, 15717, 15783, 15849, 15915, 15981, 16047, 16113, 16179, 16246, 16312, 16378, 16444, 16510, 16576, 16642, 16709, 16775, 16841, 16907, 16974, 17040, 17106, 17172, 17239, 17305, 17371, 17438, 17504, 17571, 17637, 17704, 17770, 17837, 17903, 17970, 18036, 18103, 18169, 18236, 18303, 18369, 18436, 18503, 18569, 18636, 18703, 18770, 18836, 18903, 18970, 19037, 19104, 19171, 19238, 19305, 19371, 19438, 19505, 19572, 19640, 19707, 19774, 19841, 19908, 19975, 20042, 20109, 20177, 20244, 20311, 20378, 20446, 20513, 20580, 20648, 20715, 20783, 20850, 20917, 20985, 21052, 21120, 21187, 21255, 21323, 21390, 21458, 21526, 21593, 21661, 21729, 21797, 21864, 21932, 22000, 22068, 22136, 22204, 22272, 22340, 22407, 22476, 22544, 22612, 22680, 22748, 22816, 22884, 22952, 23021, 23089, 23157, 23225, 23294, 23362, 23430, 23499, 23567, 23636, 23704, 23773, 23841, 23910, 23978, 24047, 24116, 24184, 24253, 24322, 24390, 24459, 24528, 24597, 24666, 24735, 24804, 24873, 24942, 25011, 25080, 25149, 25218, 25287, 25356, 25425, 25494, 25564, 25633, 25702, 25772, 25841, 25910, 25980, 26049, 26119, 26188, 26258, 26327, 26397, 26467, 26536, 26606, 26676, 26746, 26815, 26885, 26955, 27025, 27095, 27165, 27235, 27305, 27375, 27445, 27515, 27586, 27656, 27726, 27796, 27867, 27937, 28007, 28078, 28148, 28219, 28289, 28360, 28430, 28501, 28572, 28642, 28713, 28784, 28855, 28925, 28996, 29067, 29138, 29209, 29280, 29351, 29422, 29493, 29565, 29636, 29707, 29778, 29850, 29921, 29992, 30064, 30135, 30207, 30278, 30350, 30421, 30493, 30565, 30637, 30708, 30780, 30852, 30924, 30996, 31068, 31140, 31212, 31284, 31356, 31428, 31501, 31573, 31645, 31718, 31790, 31862, 31935, 32007, 32080, 32153, 32225, 32298, 32371, 32443, 32516, 32589, 32662, 32735, 32808, 32881, 32954, 33027, 33100, 33174, 33247, 33320, 33394, 33467, 33540, 33614, 33688, 33761, 33835, 33908, 33982, 34056, 34130, 34204, 34278, 34352, 34426, 34500, 34574, 34648, 34722, 34796, 34871, 34945, 35020, 35094, 35168, 35243, 35318, 35392, 35467, 35542, 35617, 35692, 35766, 35841, 35916, 35992, 36067, 36142, 36217, 36292, 36368, 36443, 36519, 36594, 36670, 36745, 36821, 36897, 36972, 37048, 37124, 37200, 37276, 37352, 37428, 37504, 37581, 37657, 37733, 37810, 37886, 37963, 38039, 38116, 38193, 38269, 38346, 38423, 38500, 38577, 38654, 38731, 38808, 38886, 38963, 39040, 39118, 39195, 39273, 39350, 39428, 39506, 39584, 39661, 39739, 39817, 39895, 39974, 40052, 40130, 40208, 40287, 40365, 40444, 40522, 40601, 40680, 40758, 40837, 40916, 40995, 41074, 41153, 41233, 41312, 41391, 41471, 41550, 41630, 41709, 41789, 41869, 41949, 42028, 42108, 42189, 42269, 42349, 42429, 42509, 42590, 42670, 42751, 42832, 42912, 42993, 43074, 43155, 43236, 43317, 43398, 43480, 43561, 43642, 43724, 43805, 43887, 43969, 44051, 44133, 44215, 44297, 44379, 44461, 44543, 44626, 44708, 44791, 44874, 44956, 45039, 45122, 45205, 45288, 45371, 45455, 45538, 45621, 45705, 45789, 45872, 45956, 46040, 46124, 46208, 46292, 46376, 46461, 46545, 46630, 46714, 46799, 46884, 46969, 47054, 47139, 47224, 47310, 47395, 47480, 47566, 47652, 47738, 47823, 47909, 47996, 48082, 48168, 48254, 48341, 48428, 48514, 48601, 48688, 48775, 48862, 48949, 49037, 49124, 49212, 49300, 49387, 49475, 49563, 49651, 49740, 49828, 49916, 50005, 50094, 50183, 50271, 50361, 50450, 50539, 50628, 50718, 50807, 50897, 50987, 51077, 51167, 51257, 51348, 51438, 51529, 51620, 51711, 51802, 51893, 51984, 52075, 52167, 52258, 52350, 52442, 52534, 52626, 52719, 52811, 52904, 52996, 53089, 53182, 53275, 53369, 53462, 53556, 53649, 53743, 53837, 53931, 54025, 54120, 54214, 54309, 54404, 54499, 54594, 54690, 54785, 54881, 54976, 55072, 55168, 55265, 55361, 55458, 55554, 55651, 55748, 55846, 55943, 56041, 56138, 56236, 56334, 56432, 56531, 56629, 56728, 56827, 56926, 57025, 57125, 57224, 57324, 57424, 57524, 57625, 57725, 57826, 57927, 58028, 58130, 58231, 58333, 58435, 58537, 58639, 58741, 58844, 58947, 59050, 59153, 59257, 59361, 59465, 59569, 59673, 59778, 59882, 59987, 60093, 60198, 60304, 60410, 60516, 60622, 60729, 60835, 60942, 61050, 61157, 61265, 61373, 61481, 61590, 61698, 61807, 61916, 62026, 62136, 62246, 62356, 62466, 62577, 62688, 62799, 62911, 63023, 63135, 63247, 63360, 63473, 63586, 63700, 63813, 63927, 64042, 64156, 64271, 64387, 64502, 64618, 64734, 64851, 64968, 65085, 65202, 65320, 65438, 65557, 65676, 65795, 65914, 66034, 66154, 66275, 66396, 66517, 66638, 66760, 66883, 67005, 67128, 67252, 67376, 67500, 67625, 67750, 67875, 68001, 68127, 68254, 68381, 68508, 68636, 68765, 68893, 69023, 69152, 69283, 69413, 69544, 69676, 69808, 69940, 70073, 70207, 70341, 70475, 70610, 70746, 70882, 71019, 71156, 71293, 71432, 71570, 71710, 71850, 71990, 72131, 72273, 72415, 72558, 72702, 72846, 72991, 73136, 73283, 73429, 73577, 73725, 73874, 74024, 74174, 74325, 74477, 74630, 74783, 74937, 75092, 75248, 75404, 75562, 75720, 75879, 76039, 76200, 76362, 76525, 76689, 76854, 77019, 77186, 77354, 77523, 77693, 77864, 78036, 78209, 78384, 78559, 78736, 78914, 79093, 79274, 79456, 79639, 79824, 80010, 80198, 80387, 80577, 80770, 80963, 81159, 81356, 81555, 81756, 81958, 82163, 82369, 82578, 82788, 83001, 83216, 83433, 83653, 83875, 84099, 84327, 84557, 84789, 85025, 85264, 85506, 85751, 86000, 86252, 86509, 86769, 87033, 87302, 87575, 87853, 88137, 88425, 88720, 89021, 89328, 89642, 89963, 90293, 90632, 90979, 91338, 91707, 92089, 92485, 92896, 93324, 93773, 94244, 94742, 95273, 95842, 96462, 97146, 97923, 98845, 100046, 102944};

// functions

extern const uint16_t sin_lut[LUTCOUNT];  // Q1.15 format

int32_t sinus(int t) {
    while (t < 0) t += SIN_FULL_CYCLE;
    t %= SIN_FULL_CYCLE;

    int quarter_len = LUTCOUNT;
    int quarter = t / quarter_len;       // 0 to 3
    int idx     = t % quarter_len;

    int32_t val;
    switch (quarter) {
        case 0: val =  sin_lut[idx]; break;                       // [0, Ï€/2]
        case 1: val =  sin_lut[quarter_len - 1 - idx]; break;     // [Ï€/2, Ï€]
        case 2: val = -sin_lut[idx]; break;                       // [Ï€, 3Ï€/2]
        case 3: val = -sin_lut[quarter_len - 1 - idx]; break;     // [3Ï€/2, 2Ï€]
        default: val = 0; break;
    }

    return (val<<1);  // Now returns 16.16 fixed-point
}



int32_t cosinus(int t) {
    return sinus((t + LUTCOUNT / 4) % LUTCOUNT); // phase shift by 90Â°
}
                       // :contentReference[oaicite:0]{index=0}

int32_t sinrad(int32_t t) { // takes int32 16.16 corresponding to radians
	int32_t factor = FIX16_DIV(convert(LUTCOUNT * 4),FIX16_MULT(convert(2),PI16)); // N/2pi
	int integer = (int)(inconvert((FIX16_MULT(t, factor)))); // 32.0 degree
	//printf("%i,", integer);
	return sinus(integer); // returns 16.16 decimal
}

int32_t cosrad(int32_t t) {
    int32_t factor = FIX16_DIV(convert(LUTCOUNT), FIX16_MULT(convert(2), PI16));
    int integer = (int)(inconvert(FIX16_MULT(t, factor)));
    return cosinus(integer);
}

/*
int32_t lut_index(int32_t ratio) {
    if (ratio < 0) ratio = -ratio;
    if (ratio > (1 << 16)) ratio = (1 << 16);
    return (int)(((int64_t)ratio * 512) >> 16);
}

extern const int32_t asin_lut[1024];
*/

int32_t fix_asin(int32_t x) {
    if (x < -convert(1)) x = -convert(1);
    if (x >  convert(1)) x =  convert(1);

    int32_t abs_x = (x < 0) ? -x : x;

    // Scale to index in LUT
    int32_t scaled = abs_x * (LUTCOUNT - 1);      // 1024 steps
    int index = scaled >> 16;
    int32_t frac = scaled & 0xFFFF;

    if (index >= (LUTCOUNT-1)) index = (LUTCOUNT-2); // to safely access [i] and [i+1]

    int32_t y0 = asin_lut[index];
    int32_t y1 = asin_lut[index + 1];
    int32_t dy = y1 - y0;
    int32_t interp = y0 + FIX16_MULT(dy, frac);

    return (x >= 0) ? interp : -interp;
}



static inline int32_t fix_atan_lut(int32_t r) {
    if (r < 0) r = -r;
    if (r > convert(1)) r = convert(1);

    int32_t scaled = r * (LUTCOUNT - 1); // [0, 1] â†’ [0, 1023]
    int index = scaled >> 16;
    int32_t frac = scaled & 0xFFFF;

    if (index >= (LUTCOUNT - 1)) index = (LUTCOUNT - 2);

    int32_t y0 = atan_lut[index];
    int32_t y1 = atan_lut[index + 1];
    int32_t dy = y1 - y0;
    return y0 + FIX16_MULT(dy, frac);
}

int32_t fix_atan2(int32_t y, int32_t x) {
    if (x == 0) {
        if (y > 0) return PI16 / 2;
        if (y < 0) return -PI16 / 2;
        return 0; // undefined
    }

    int32_t r = (int32_t)(((int64_t)y << 16) / x);  // r = y / x in 16.16
    int32_t abs_r = (r < 0) ? -r : r;

    int32_t angle;
    if (abs_r > convert(1)) {
        // r > 1 â†’ angle = Ï€/2 - atan(1/r)
        int32_t recip = (int32_t)(((int64_t)convert(1) << 16) / abs_r); // 16.16
        angle = PI16 / 2 - fix_atan_lut(recip);
    } else {
        angle = fix_atan_lut(abs_r);
    }

    if (r < 0) angle = -angle;

    // Quadrant correction based on signs
    if (x > 0) return angle;                    // Q1, Q4
    if (y >= 0) return angle + PI16;            // Q2
    return angle - PI16;                        // Q3
}
